FLAVOUR_SUPPORTED = ""

GZIPPED = .gz
EXTRANAME = hd-media/

TARGET = $(KERNEL) $(INITRD) hd-media_dtbs hd-media_bootscript hd-media_tarball

MANIFEST-INITRD = "Initrd for use on USB memory sticks"
MANIFEST-KERNEL = "Kernel for use on USB memory sticks"

.PHONY: hd-media_dtbs
hd-media_dtbs: $(TEMP_DTBS)
	mkdir -p $(SOME_DEST)/$(EXTRANAME)dtbs
	set -ex ; for dtb in $(TEMP_DTBS)/*.dtb ; do \
		tgt=$(SOME_DEST)/$(EXTRANAME)dtbs/$$(basename $$dtb); \
		cp $$dtb $$tgt ; \
		update-manifest $$tgt "Device Tree Blob: $$(basename $$dtb)";\
	done
	cp boot/README.device-tree $(SOME_DEST)/$(EXTRANAME)dtbs/README
	update-manifest $(SOME_DEST)/$(EXTRANAME)dtbs/README  "Device Tree Blobs README"

.PHONY: hd-media_bootscript
hd-media_bootscript:
	mkimage -T script -A arm -d boot/arm/bootscr.mainline_common $(SOME_DEST)/$(EXTRANAME)boot.scr
	update-manifest $(SOME_DEST)/$(EXTRANAME)boot.scr "Universal boot script for mainline u-boot (>= v2014.10)"

.PHONY: hd-media_tarball
hd-media_tarball: $(KERNEL) $(INITRD) hd-media_dtbs hd-media_bootscript
	tar -C $(SOME_DEST)/$(EXTRANAME) -zcf $(TEMP)/hd-media.tar.gz boot.scr initrd.gz vmlinuz dtbs/
	mv  $(TEMP)/hd-media.tar.gz $(SOME_DEST)/$(EXTRANAME)
